module Task8 where

import qualified Data.Array as A
import Data.List (nub, concat)

input = "102200120221123133322123221134224301040024344534431245323303212210030001244234132301200020310012011\n\
\210101220131232022104432220132221131234351145114524135253112332342312410211104233102330122201111010\n\
\002220112233222031400442434031011023425412431121343221233533224144034042201244323431032200232101012\n\
\200202231012120110032413231132224255311432523511252253221451514335154032332342133133133321000002220\n\
\021023013300203310410132030422351131224513211322513324212421215535543510221102312443303330132321201\n\
\001000330003220124130413311435314333354422521213321212242324211253514231442434324114124112323213001\n\
\100102012222213131014440444431424445231224532554231331431314545111552115245032312032141101232330001\n\
\112030330123430022102413341315541514452151222122465233323221252533543352235542444442034423330030001\n\
\212220032321414402242244545523153553234542346353663246322653331223132222122541241230343040131203330\n\
\223102313102121144404243154422531311366656226224656422433224222614245141545331252010213304333030112\n\
\100313021142341022443315312525141153654243246335365444433433242564631411555354514413134142003013020\n\
\122100230243123431213132113351516264232625236426434255344356324456666353241325433254422420014331213\n\
\011210132432422344542335312531565433356653464522633446652252525265444443411223445354243041444410112\n\
\012133444121412434113141455535326243636244246332533653666555655543624564414533423445222430103212001\n\
\113304142301420414252411342353422662436622352326554363565223456253643362524444125221430220323313003\n\
\001122120140431312155253523546562455546532337333734675677655555353242655326323332554242403211400130\n\
\220142433201434435251233346626262436553645465666436354364343766652325424552325555415524344132040133\n\
\320312104024221552154216633626342464343336367474637464363774565432432226533664243124324341232022302\n\
\021242423424424124554553554665252264547377663445576756547536647776752524253664541521223254440241211\n\
\224110204241522415245443625466664753754755446565575545765564376455744544623665244525325432143401021\n\
\123432321343113542235654656235537756354436347355473343434764344347577566652236626435125155304243232\n\
\111402302541335421642222546635377463553444734465334736537344446664655457236454264531411125250241041\n\
\404243032431142122562535544633766456373766657455756567565566363544655474453243534523435114313430121\n\
\324421025342212256655666646657743477746456644785547574464646443645543543772542656432522353312430232\n\
\001414034352355125223334566537547773645784645548858657864456755667733554477463225644645134533303241\n\
\120200313513214346523222343534564536445747674784578474688866757844677344466452533232643351552212344\n\
\140004115211334466633442746534576475745584467454447866848876885674465363455562246436243422245134202\n\
\240311554155422565345224744376657664864784867858785584464568776546846456646764446265456535141322412\n\
\120433124512123235464464474374555586847475678876745784486754865847644364763436544532466611335224012\n\
\203035433353423566534634356646374787666466647567896557758654565578474554555573556364424245252252414\n\
\303212242114562363256553377464644876787465779966759998978596466765544677666544346655666361143511511\n\
\321435212244453243635446333355488787767685799988798856567786944567778876663776374463333531123254443\n\
\321335455154254226677665466555765485559588886969685888679596565587486648633737637533532565154423142\n\
\212254414122253423565743374454588455585686588899875787766987689775655787747564557655455342253355324\n\
\421422342453446266357576668665558765689955566967658699885985767778745455574334765743326436551224544\n\
\322421225225343446747576654567854856855589798985878786666568869665488456645344737545652626331455433\n\
\222122521256633657563766766555546555855966796578977676986675868875545864778446455474333436233525114\n\
\023254314555364655763674546647685985696665859897979798699895787776754674648744636743425352264545211\n\
\225135212533322677553356845558877878985878796877869899696786965865955448755574744366722233654152541\n\
\351532143355433244443675556588657988776586966876989779969768796786657855888885536646664425523132442\n\
\124515553625366556335768876868569859658686789999979886979876785986595667566478737355543355336355531\n\
\014314156442535433773675645776556955878889968787696997666987675979557987658877644756564444225521113\n\
\242252525623363454375455757457997976769999667777997788867869896685899586858856533746453433352234235\n\
\023124456566552443376536887866777785856779768999879768967669699896775996557775364533554542434243532\n\
\223212425265546436677586688558777558698896789789999779996888676857756888467864635543336466465124415\n\
\515252333623442437447768566445979556986878966888877987877868886887578986858454675534554625552123132\n\
\412113362546222337753387655589789688778666867977779997787677869678997869748548765747344532346625545\n\
\352443343534562353437684565877667578896989969879787778999697976996568955766447746674356435354542353\n\
\244532256342454775576468664478555979788879687779998799789879799769756679848467875743746256555435243\n\
\252415145222625746477544486589996556968998687777998898799777866997997988457845575665744522252455434\n\
\121252366666324777366354648567898987766689978889888798878866677775798597554668636346634424246241143\n\
\542231223323635647757665768465587586899676779988899797877986698665695688447754433537676242553421153\n\
\315225522426633565736564558659658677797979699989788878799876868665785765575768537473673552525343311\n\
\341442555252446433735587744487688988999678768989777798879679969679999999468485664567446334355524445\n\
\211522352343562564765585578469688867869667998977797998798888877686996875745458474656532245544211451\n\
\443143434636652677635354556867668988666786999778788779898699967757566589857774775447532524634131213\n\
\354152534456625467746446747678795956888788886888778789977879678658675695565654557453375652556521414\n\
\332344344563334636745465546446885667986686979788897779997969896886588854565468765446733444424331344\n\
\431135355245345747455456787578659995678989886897697777968798896878886857486556576564733534432142551\n\
\433233316556526255633378546755489975567978866786699677769889695967977758448667443757622555435434414\n\
\314545435553452545376335754568779985959566976978878677678777868796558868674848566345422265562252423\n\
\145542533645544657663644857446856777777978979788686887887779999586699644786474643375746262664243444\n\
\241353431554264566677765464654485867995877868699696987786976958699567574887566645746345422454143441\n\
\423135115666355654375646368544778695956967666977986977697899789689766567785666675773435325262524551\n\
\121242511146354267445534487686788465757658866587778978657999996978874566576767474455232556422235215\n\
\123455555234455453537357738876787679765895779577559859577987565678475674467346366664333243354411434\n\
\113111232245536443357354765765648848855685798699976566767695895956674785776437653532662646355133522\n\
\034245121152464645264454454458567747667859589888698959868659799684876674563464553323545665335113414\n\
\321542511513646356466656747484676777865877857765878865985699957645675457654757775562546453441355233\n\
\001025225344365554343664374675774455757659659777596798967769555466788558746776567242245663132335222\n\
\240224423154453466635367766446776854675446678578756687675776756657745777743437435645463423354213440\n\
\143321412151126564642553643433487476454478865659797785666686467645568676646646473662544534334515212\n\
\300115342534164343654435573634646548844886487647548855785866576457458436355575564454635251454435213\n\
\331024513222536555236525434736356587874465687545468546688486445577473343474477264254545135125421102\n\
\243234315251353456432325545375553348757866746774448555444556677858854465433745435663355535522444302\n\
\222242353531424355464446643456665437556444758477468585685746584584647636633743354324232532231543430\n\
\232321431115224556244223336543364633735554888856857755655758564767754545375346544656511252413530322\n\
\443102445423141155626432534467654356676376855848756755575858656334754446333542345522445552422021421\n\
\122144244122552411433244654557543734547646557548877564645335454433576334464425263323112222114003403\n\
\241010140424452455226655236255746455563753554474656337467375374536454766656446525662141142521030310\n\
\003123001114142554125526633642767765437644573343536573563636666365667652335363363321131215341024444\n\
\122433034123242324526252334224465375535435776677656444337356333564364442536426546535413351434442403\n\
\012032130443313512142334334232632463533753446736437357543755653745644654244446442551351434201043201\n\
\123432104214215425255545532345225366546356457753453435764534444432222425353255324435341532212441100\n\
\122231022230433534232123222566354453436645454476533354465573437634666223324445223122344241413403220\n\
\112110012033231221323443134255336365322364443757433347343746254333526424644325111313532214100130002\n\
\000013103142014413122533343334343335263464325254335443366245355455625252566552214225151144323332120\n\
\313300010430420353244125522132426466255355444624632264532642466635524442242431233341320143344442332\n\
\232120313033343242144144352243623263245464423245465622443446436362336321555545313154201324441110203\n\
\103011001110214411345544335425116266333555324456646522333423435432424344435555224341402040022203300\n\
\222303333302140132001312342553322343232445543335233323222554662464411343213214525220341304342100233\n\
\231113123213311002102322233322235413333535624634455543444366422633445212132343132400040434221232230\n\
\103320010113214231110254523114243444121544236632534455264632443421454553331443122123000343120020102\n\
\213132131011312123433303212223431254241531411266432544214153545355412323324230143343304101121201113\n\
\110210203103022203344123142431553332324551324112424531442554431321223224324223004404030411100120120\n\
\120111302211224404102444220332233212524433322312343524235355245433352212141024210012324123323312101\n\
\212220310221122231114014131431245134434533152114425513144445231545452244244103411331010011212031200\n\
\211120022231100333330313111120423213143252332533514251453113433321354142442041432101120010313310122\n\
\111210213300233203233222413444104203323252533215253431341253534525013210232012413312211122123302112"

lns = lines input
width = length $ head lns 
height = length lns

p = A.listArray (1, height) $ map (A.listArray (1, width)) lns


horizontalA y = [(x, y) | x <- [1..width]]
horizontalB y = [(x, y) | x <- [width,width - 1 .. 1]]
verticalA   x = [(x, y) | y <- [1..height]]
verticalB   x = [(x, y) | y <- [height,height - 1 .. 1]]

rows =
    let a = map horizontalA [1..height]
        b = map horizontalB [1..height]
        c = map verticalA   [1..width]
        d = map verticalB   [1..width]
    in  a ++ b ++ c ++ d

get :: (Int, Int) -> Char
get (x, y) = p A.! y A.! x

seen (r:row) =
    let see current []     = [current]
        see current (r:rs) = if get current < get r then current : see r rs else see current rs
    in  see r row

answer1 = nub $ concat $ map seen rows

--

rowScore baseHeight [] = 0
rowScore baseHeight (x:xs) = 
    if baseHeight <= get x 
    then 1
    else 1 + rowScore baseHeight xs

score p@(x, y) =
    let f xs = rowScore (get p) xs
        top   = f [(x, y') | y' <- [y - 1, y - 2 .. 1]]
        down  = f [(x, y') | y' <- [y + 1 .. height]]
        left  = f [(x', y) | x' <- [x - 1, x - 2 .. 1]]
        right = f [(x', y) | x' <- [x + 1 .. width]]
    in  product [top, down, left, right]

answer2 = maximum $ map score [(x, y) | x <- [1..width], y <- [1..height]]